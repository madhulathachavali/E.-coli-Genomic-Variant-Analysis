---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
# View basic information
variants

```
```{r}
# View first few rows of fixed data
head(variants@fix)

```
```{r}
# Check first few rows of genotype data
head(variants@gt)


```
```{r}
# Get summary of variants
summary(variants)

```
```{r}
# Total number of variants
nrow(variants@fix)

# Variant chromosomes
unique(variants@fix[,"CHROM"])

```
```{r}
# Total number of variants
total_variants <- nrow(variants@fix)
print(paste("Total Variants:", total_variants))

# Chromosome
chromosome <- unique(variants@fix[,"CHROM"])
print(paste("Chromosome:", chromosome))

# Variant Positions
variant_positions <- variants@fix[,"POS"]
summary(as.numeric(variant_positions))


```

```{r}
# Extract Genotype Data
genotype_data <- variants@gt

# Count Variant Types per Sample
variant_counts <- apply(genotype_data, 2, function(x) {
  sum(x != "0/0")
})
print("Variant Counts per Sample:")
print(variant_counts)


```
```{r}
# Quality Score Analysis
quality_scores <- as.numeric(variants@fix[,"QUAL"])
boxplot(quality_scores, main="Variant Quality Scores")

# Mutation Pattern
ref_allele <- variants@fix[,"REF"]
alt_allele <- variants@fix[,"ALT"]
mutation_table <- table(paste(ref_allele, "->", alt_allele))
print("Mutation Patterns:")
print(mutation_table)


```
```{r}
library(vcfR)

# Extract genotype matrix
gt_matrix <- extract.gt(variants)

# Count variants per sample
sample_variant_counts <- apply(gt_matrix, 2, function(x) {
  sum(x != "0/0")  # Count non-reference genotypes
})

# Identify unique variants per sample
unique_variants_per_sample <- apply(gt_matrix, 2, function(x) {
  unique_vars <- unique(x[x != "0/0"])
  length(unique_vars)
})

# Create comparison dataframe
variant_comparison <- data.frame(
  Sample = names(sample_variant_counts),
  Total_Variants = sample_variant_counts,
  Unique_Variants = unique_variants_per_sample
)

# Print comparison results
print(variant_comparison)\



```
```{r}

library(ggplot2)
library(stringr)

# Extract sample IDs from file paths
variant_comparison$Sample_ID <- str_extract(variant_comparison$Sample, "SRR\\d+")

# Enhanced Variant Distribution Plot
ggplot(variant_comparison, aes(x=Sample_ID, y=Total_Variants)) +
  geom_bar(stat="identity", fill="steelblue") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
    plot.title = element_text(hjust = 0.5)
  ) +
  labs(
    title = "Variant Distribution Across E. coli Samples",
    x = "Sample ID",
    y = "Total Variants"
  ) +
  coord_flip()


```

```{r}

library(vcfR)
library(ape)

# Extract genotype matrix
gt_matrix <- extract.gt(variants)

# Convert genotype to numeric matrix
gt_numeric <- matrix(as.numeric(factor(gt_matrix)), 
                     nrow = nrow(gt_matrix), 
                     ncol = ncol(gt_matrix))

# Subsample variants to reduce computational load
set.seed(123)
variant_subset_indices <- sample(1:nrow(gt_numeric), 5000)
gt_subset <- gt_numeric[variant_subset_indices, ]

# Create distance matrix
dist_matrix <- dist(gt_subset)

# Construct Neighbor-Joining Tree
phylo_tree <- nj(dist_matrix)

# Visualize Tree
plot(phylo_tree, 
     main="E. coli Samples Phylogenetic Tree",
     cex = 0.7)


```
```{r}
library(ape)

# Total Tree Length
total_tree_length <- sum(phylo_tree$edge.length)

# Mean Branch Length
mean_branch_length <- mean(phylo_tree$edge.length)

# Branch Length Variance
branch_length_variance <- var(phylo_tree$edge.length)

# Number of Nodes
num_nodes <- phylo_tree$Nnode

# Number of Tips
num_tips <- length(phylo_tree$tip.label)

# Calculate Symmetry Index
symmetry_index <- (num_nodes - num_tips + 1) / (2 * num_tips - 3)

```







Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
